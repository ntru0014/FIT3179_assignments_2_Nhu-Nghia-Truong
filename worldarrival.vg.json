{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Australia visitors of January 2014 to 2020 sorted in countries",
    "fontSize": 15,
    "fontWeight": "bold",
    "anchor": "middle", 
    "color": "black"
  },
  "description": "Interactive choropleth map with filters for month and metric, displaying vistor arrival data.",
  "background": "white",
  "width": 875,
  "height": 500,

  "params": [
    {
      "name": "Year_selection",
      "value": 2015,
      "bind": {
        "input": "range",
        "min": 2014,
        "max": 2020,
        "step": 1,
        "name": "Year:  "
      }
    }
  ],

    "projection": {"type": "equirectangular"},

  "layer": [
    {
        "data": {
            "url": "data/ne_110m_admin_0_countries.json",
            "format": {
              "type": "topojson",
              "feature": "ne_110m_admin_0_countries"
            }
        },
        "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
        "transform": [
        {
          "calculate": "'Data is not available in country: ' + datum.properties.NAME",
          "as": "nullnote"
        }
        ],
        "encoding": {
            "tooltip":{
              "field": "nullnote"
            }
          }
    },
    {
        "data": {
            "url": "data/oceans.topojson",
            "format": {"type": "topojson", "feature": "oceans"}
        },
        "mark": {"type": "geoshape", "fill": "skyblue"}
    },
    {
      "data": {"url": "data/short_term_arrivals_long.csv"},
      "transform": [
        {"filter": "datum.year == Year_selection"},
        {
          "lookup": "country",
          "from": {
            "data": {
              "url": "data/ne_110m_admin_0_countries.json",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "key": "properties.NAME"
          },
          "as": "geo"
        }
      ],

      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.6},
      "encoding": {
        "shape": {"field": "geo", "type": "geojson"},
        "color": {
            "field": "arrivals",
            "type": "quantitative",
            "scale": {
            "type": "threshold",
            "domain": [5000, 50000, 100000],
            "range": ["#FDE725","#35B779","#31688E","#440154" ]
            
        }
        },
        "tooltip": [
          {"field": "country", "type": "nominal", "title": "Country:"},
          {"field": "year", "type":"nominal","title":"Year:"},
          {"field": "arrivals","type":"quantitative","title":"Arrivals to Australia:"}
        ]
      }
    },
    {
      "data": { "values":[
        {
          "lat":-46.006251,
          "lon":30.501085,
          "anno_text":"New Zealand is the country with the largest visitors in 2020 with 121.300 people"
        }
      ] 
      },
        "mark": { "type": "text", "dx": 6, "dy": -6,"fontWeight": "bold", "fontSize": 12},
        "encoding": {
        "text": { "field": "anno_text" },
        "longitude": { "field": "lon","type":"quantitative" },
        "latitude": { "field": "lat","type":"quantitative" }
      } 
    }
  ]
}
